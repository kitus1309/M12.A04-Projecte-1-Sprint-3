CREATE TABLE IF NOT EXISTS categories (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL UNIQUE,
    slug VARCHAR(255) NOT NULL UNIQUE
);

CREATE TABLE IF NOT EXISTS statuses (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) UNIQUE,
    slug VARCHAR(255) UNIQUE
);

CREATE TABLE IF NOT EXISTS users (
    id INT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(255) NOT NULL UNIQUE,
    email VARCHAR(255) NOT NULL UNIQUE,
    role ENUM('admin', 'moderator', 'wanner') NOT NULL,
    password VARCHAR(255) NOT NULL,
    email_token VARCHAR(255) DEFAULT NULL,
    verified BOOLEAN NOT NULL DEFAULT FALSE,
    created DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    token VARCHAR(255),
    token_expiration DATETIME
);

CREATE TABLE IF NOT EXISTS products (
    id INT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(255) NOT NULL,
    description TEXT NOT NULL,
    photo VARCHAR(255) NOT NULL,
    price DECIMAL(10, 2) NOT NULL,
    category_id INT NOT NULL,
    status_id INT NOT NULL,
    seller_id INT NOT NULL,
    created DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    updated DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (category_id) REFERENCES categories(id),
    FOREIGN KEY (status_id) REFERENCES statuses(id),
    FOREIGN KEY (seller_id) REFERENCES users(id)
);

CREATE TABLE IF NOT EXISTS orders (
    id INT AUTO_INCREMENT PRIMARY KEY,
    product_id INT,
    buyer_id INT,
    offer DECIMAL(10, 2),
    created DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (product_id) REFERENCES products(id),
    FOREIGN KEY (buyer_id) REFERENCES users(id)
);

CREATE TABLE IF NOT EXISTS banned_products (
    product_id INT PRIMARY KEY,
    reason TEXT NOT NULL,
    created DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (product_id) REFERENCES products(id)
);

CREATE TABLE IF NOT EXISTS blocked_users (
    user_id INT PRIMARY KEY,
    message TEXT NOT NULL,
    created DATETIME NOT NULL DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id)
);

CREATE TABLE IF NOT EXISTS confirmed_orders (
    order_id INT PRIMARY KEY,
    created DATETIME DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (order_id) REFERENCES orders(id)
);



-- Inserir dades
-- Insertem categories
INSERT INTO categories (name, slug) VALUES 
('Electrònica', 'electronica'), 
('Roba', 'roba'), 
('Joguines', 'joguines');

-- Insertem estats
INSERT INTO statuses (name, slug) VALUES 
('Nou', 'nou'), 
('Usat', 'usat'), 
('En Proceso', 'en-proceso'), 
('Vendido', 'vendido');

-- Insertem usuaris (les contrasenyes s'han de canviar per hashes segurs)
INSERT INTO users (name, email, role, verified, password) VALUES 
('Joan Pérez', 'joan@example.com', 'admin', TRUE, 'password_hash'),
('Anna García', 'anna@example.com', 'moderator', TRUE, 'password_hash'),
('Elia Rodríguez', 'elia@example.com', 'wanner', TRUE, 'password_hash'),
('Kevin Salardú', 'kevin@example.com', 'wanner', TRUE, 'password_hash'),
('claudiu', 'clvl@fp.insjoaquimmir.cat', 'wanner', TRUE, 'password_hash');

-- Insertem productes
INSERT INTO products (title, description, photo, price, category_id, status_id, seller_id) VALUES 
('Televisio', 'Una tele gran', 'no_image.png', 33, 1, 1, 5),
('Camiseta', 'Una camiseta roja', 'no_image.png', 23, 2, 1, 5),
('Telèfon mòbil', 'Un telèfon intel·ligent d''última generació.', 'no_image.png', 599.99, 1, 1, 5);
